{"version":3,"sources":["../../../../src/utills/Kafka/test/UAVPositionTest.js"],"names":["avro","AvroSerializer","ProducerFacade","ConsumerFacade","resources","avscSchema$","specificSchema","parse","specificSerializer","producerPromise","options","groupId","fetchMaxWaitMs","fetchMaxBytes","consumer","testUAV","id","label","ENTITY_TYPE_NAMES","SIGINT","position","longitude","MAP_CENTER","latitude","height","velocity","UAVData","timestamp","Date","getTime","type","UAVPositionTest","Subscribe","onMessage","onError","console","log","msg","subscribe","setTimeout","close","process","exit","Start","then","setInterval","producer","send","catch","err"],"mappings":"AAAA;;;;;;AACA;;IAAOA,I;;AACP;;IAAOC,c;;AACP;;IAAOC,c;;AACP;;IAAOC,c;;AAEP;;IAAOC,S;;;;AAEP,IACIC,ohBADJ;AAAA,IAcIC,iBAAiBN,KAAKO,KAAL,CAAWF,WAAX,CAdrB;AAAA,IAeIG,qBAAqB,IAAIP,cAAJ,CAAmBK,cAAnB,CAfzB;AAAA,IAgBIG,kBAAkB,IAAIP,cAAJ,CAAmB,gBAAnB,EAAqCM,kBAArC,CAhBtB;AAAA,IAiBIE,UAAU;AACNC,aAAS,aADH;AAENC,oBAAgB,IAFV;AAGNC,mBAAe,OAAO;AAHhB,CAjBd;AAAA,IAsBIC,WAAW,IAAIX,cAAJ,CAAmB,gBAAnB,EAAqC,kBAArC,EAAyDO,OAAzD,EAAkEF,kBAAlE,CAtBf;AAAA,IAwBIO,UAAa;AACTC,QAAI,UADK;AAETC,WAAUb,UAAUc,iBAAV,CAA4BC,MAAtC,UAFS;AAGTC,cAAU;AACNC,mBAAWjB,UAAUkB,UAAV,CAAqBD,SAD1B;AAENE,kBAAUnB,UAAUkB,UAAV,CAAqBC,QAFzB;AAGNC,gBAAQ;AAHF,KAHD;AAQTC,cAAW;AACPJ,mBAAW,CAAC,MADL;AAEPE,kBAAU,KAFH;AAGPC,gBAAQ;AAHD;AARF,CAxBjB;AAHA;;;AA0CA,IAAIE,UAAU;AACVC,eAAY,IAAIC,IAAJ,EAAD,CAAWC,OAAX,EADD;AAEVb,QAAID,QAAQC,EAFF;AAGVc,UAAM1B,UAAUc,iBAAV,CAA4BC,MAHxB;AAIVE,eAAWN,QAAQK,QAAR,CAAiBC,SAJlB;AAKVE,cAAUR,QAAQK,QAAR,CAAiBG,QALjB;AAMVC,YAAQT,QAAQK,QAAR,CAAiBI;AANf,CAAd;;AASA,IAAMO,kBAAkB;AACpBC,eAAY,mBAACC,SAAD,EAAYC,OAAZ,EAAwB;AAChCC,gBAAQC,GAAR,CAAYV,OAAZ;AACA,YAAIO,YAAYA,aAAc;AAAA,mBAAOE,QAAQC,GAAR,CAAYC,GAAZ,CAAP;AAAA,SAA9B;AAAA,YACAH,UAAUA,WAAY;AAAA,mBAAOC,QAAQC,GAAR,CAAYC,GAAZ,CAAP;AAAA,SADtB;;AAGAvB,iBAASwB,SAAT,CAAmBL,SAAnB,EAA8BC,OAA9B;AACAK,mBAAW;AAAA,mBAAMzB,SAAS0B,KAAT,CAAe;AAAA,uBAAMC,QAAQC,IAAR,EAAN;AAAA,aAAf,CAAN;AAAA,SAAX,EAAuD,IAAI,EAAJ,GAAS,IAAhE;AACH,KARmB;AASpBC,WAAO,iBAAM;AACTlC,wBAAgBmC,IAAhB,CAAqB;AAAA,mBACrBC,YAAY,YAAM;AACdnB,wBAAQL,SAAR,IAAqBN,QAAQU,QAAR,CAAiBJ,SAAtC;AACAK,wBAAQH,QAAR,IAAoBR,QAAQU,QAAR,CAAiBF,QAArC;AACAG,wBAAQF,MAAR,IAAkBT,QAAQU,QAAR,CAAiBD,MAAnC;AACAsB,yBAASC,IAAT,CAAc,kBAAd,EAAkCrB,OAAlC,EAA2CsB,KAA3C,CAAiD;AAAA,2BAAO,YAAYb,QAAQC,GAAR,CAAYa,GAAZ,CAAnB;AAAA,iBAAjD;AACH,aALD,EAKG,IALH,CADqB;AAAA,SAArB;AAOH;AAjBmB,CAAxB;;kBAoBelB,e","file":"UAVPositionTest.js","sourcesContent":["'use strict';\r\nimport avro from 'avsc';\r\nimport AvroSerializer  from '../avroSerializer';\r\nimport ProducerFacade from '../producerFacade';\r\nimport ConsumerFacade from '../consumerFacade';\r\n// import UUID from '../uuid';\r\nimport resources from '../../../data/resources';\r\n\r\nconst \r\n    avscSchema$ =`{\r\n        \"namespace\": \"com.r39.avro\",\r\n        \"name\": \"UAVPosition\",\r\n        \"type\": \"record\",\r\n        \"fields\": [\r\n            { \"name\": \"timestamp\", \"type\": \"long\" },\r\n            { \"name\": \"id\", \"type\": \"string\", \"doc\": \"ID of UAV , tail serial number.\" },\r\n            { \"name\": \"type\", \"type\": \"string\", \"doc\": \"UAV type.\" },\r\n            { \"name\": \"longitude\", \"type\": \"double\" },\r\n            { \"name\": \"latitude\", \"type\": \"double\" },\r\n            { \"name\": \"height\", \"type\": \"double\" }\r\n        ]\r\n    }`,\r\n    specificSchema = avro.parse(avscSchema$),\r\n    specificSerializer = new AvroSerializer(specificSchema),\r\n    producerPromise = new ProducerFacade('127.0.0.1:2181', specificSerializer),\r\n    options = {\r\n        groupId: 'nodeGroupId',\r\n        fetchMaxWaitMs: 1000,\r\n        fetchMaxBytes: 1024 * 1024\r\n    },\r\n    consumer = new ConsumerFacade('127.0.0.1:2181', 'UAVPositionTopic', options, specificSerializer),\r\n\r\n    testUAV =    {\r\n        id: 'debug123', \r\n        label: `${resources.ENTITY_TYPE_NAMES.SIGINT}: 001`,\r\n        position: {\r\n            longitude: resources.MAP_CENTER.longitude, \r\n            latitude: resources.MAP_CENTER.latitude, \r\n            height: 69.0\r\n        },\r\n        velocity:  {\r\n            longitude: -0.0002,\r\n            latitude: 0.001,\r\n            height: 25\r\n        }\r\n    };\r\n\r\nlet UAVData = {\r\n    timestamp: (new Date).getTime(),\r\n    id: testUAV.id,\r\n    type: resources.ENTITY_TYPE_NAMES.SIGINT,\r\n    longitude: testUAV.position.longitude,\r\n    latitude: testUAV.position.latitude,\r\n    height: testUAV.position.height\r\n}\r\n\r\nconst UAVPositionTest = {\r\n    Subscribe : (onMessage, onError) => {\r\n        console.log(UAVData);\r\n        var onMessage = onMessage || (msg => console.log(msg)),\r\n        onError = onError || (msg => console.log(msg));\r\n    \r\n        consumer.subscribe(onMessage, onError);\r\n        setTimeout(() => consumer.close(() => process.exit()), 1 * 25 * 5000);\r\n    },\r\n    Start: () => {\r\n        producerPromise.then(producer =>\r\n        setInterval(() => {\r\n            UAVData.longitude += testUAV.velocity.longitude;\r\n            UAVData.latitude += testUAV.velocity.latitude;\r\n            UAVData.height += testUAV.velocity.height;        \r\n            producer.send('UAVPositionTopic', UAVData).catch(err => 'error: ' + console.log(err));\r\n        }, 5000));\r\n    }\r\n};\r\n\r\nexport default UAVPositionTest;\r\n \r\n\r\n\r\n\r\n\r\n"]}